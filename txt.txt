COMANDO PARA INICIALIZAR O SERVER
node server.js 

Passo 2: Configurar os Webhooks no Painel do Stripe

Acesse o painel de controle do Stripe e siga estas etapas:

Faça login na sua conta do Stripe.

No painel de controle, navegue para "Developer" e, em seguida, clique em "Webhooks".

Clique em "Add endpoint".

Insira a URL do seu endpoint do webhook (por exemplo, https://seuservidor.com/webhooks/stripe).

Especifique os eventos que você deseja monitorar. No seu caso, você estará interessado no evento "checkout.session.completed" para indicar pagamentos bem-sucedidos.

Clique em "Add endpoint".

=======================================================================================================================================



>ngrok http 3001


Sim, a parte /webhooks/stripe deve ser acrescentada à URL fornecida pelo ngrok. A URL completa que você deve configurar no painel 

de controle do Stripe é:

https://ce76-177-152-107-158.ngrok.io/webhooks/stripe

Essa URL inclui o domínio fornecido pelo ngrok (https://ce76-177-152-107-158.ngrok.io) e a rota específica do endpoint do 
webhook /webhooks/stripe.

Quando o Stripe enviar uma notificação de webhook para essa URL, o ngrok encaminhará a solicitação para o seu servidor local 
na porta 3001, onde você configurou o endpoint para lidar com webhooks Stripe, incluindo a rota /webhooks/stripe. Certifique-se 
de que a sua aplicação está configurada para ouvir e lidar com as notificações de webhook nessa rota.

========================================================================================================================
========================================================================================================================
========================================================================================================================

29/10/2023   20:07


>ngrok http 3001


Para indicar que o pagamento foi bem-sucedido usando webhooks do Stripe, você precisa configurar os webhooks no seu painel do 
Stripe e definir um endpoint no seu servidor para lidar com as notificações de pagamento. Aqui está um guia básico sobre como 
configurar webhooks para indicar que o pagamento foi bem-sucedido:

Passo 1: Configurar o Endpoint do Webhook no seu Servidor

Primeiro, você precisa criar um endpoint no seu servidor que irá receber as notificações de webhook do Stripe. Este é o local 
onde o Stripe enviará informações sobre eventos, como pagamentos bem-sucedidos. Seu servidor deve ser acessível pela internet.

javascript

const stripe = require('stripe')(process.env.STRIPE_SECRET_KEY);
const express = require('express');
const bodyParser = require('body-parser');
const app = express();

app.use(bodyParser.json());

app.post('/webhooks/stripe', async (req, res) => {
  const event = req.body;
  
  // Você deve validar a assinatura da webhook para garantir que as notificações são realmente do Stripe.
  // Normalmente, isso envolve verificar a assinatura usando sua chave secreta do Stripe.

  // Aqui você pode lidar com diferentes tipos de eventos, como pagamento bem-sucedido.
  if (event.type === 'checkout.session.completed') {
    const session = event.data.object;
    // Agora você sabe que o pagamento foi bem-sucedido. Você pode lidar com a criação do pedido no Printful ou outras 
    ações necessárias.
  }

  res.sendStatus(200); // Responda ao Stripe para confirmar o recebimento da webhook.
});

const port = process.env.PORT || 3000;
app.listen(port, () => {
  console.log(`Servidor rodando na porta ${port}`);
});
Passo 2: Configurar os Webhooks no Painel do Stripe

Acesse o painel de controle do Stripe e siga estas etapas:

Faça login na sua conta do Stripe.

No painel de controle, navegue para "Developer" e, em seguida, clique em "Webhooks".

Clique em "Add endpoint".

Insira a URL do seu endpoint do webhook (por exemplo, https://seuservidor.com/webhooks/stripe).

Especifique os eventos que você deseja monitorar. No seu caso, você estará interessado no evento "checkout.session.completed" 
para indicar pagamentos bem-sucedidos.

Clique em "Add endpoint".

Passo 3: Lidar com a Notificação do Webhook

Quando um pagamento é bem-sucedido e o Stripe emite o evento "checkout.session.completed", o endpoint do seu servidor receberá 
uma notificação. Nesse momento, você pode lidar com a criação do pedido no Printful ou qualquer outra ação necessária.

Lembre-se de que a segurança é crucial ao trabalhar com webhooks. Certifique-se de validar a assinatura da webhook para garantir 
que as notificações sejam autênticas. Consulte a documentação do Stripe para obter detalhes adicionais sobre como configurar e 
validar webhooks: https://stripe.com/docs/webhooks
==============================================================================================================================

>ngrok http 3001


O log "Pagamento bem-sucedido" que você forneceu mostra os detalhes da sessão de checkout do Stripe após um pagamento bem-sucedido. 
Para lidar com o pedido para o servidor Printful, você pode usar as informações disponíveis nesse objeto. Vou explicar alguns dos 
campos relevantes para criar um pedido no servidor Printful:

id: Este é o ID da sessão de checkout no Stripe, que pode ser usado para rastrear a transação.

amount_subtotal e amount_total: Esses campos indicam o valor subtotal e o valor total do pagamento em centavos. Você pode usar o 
amount_total para determinar o custo total do pedido.

customer_details: Contém informações sobre o cliente que fez o pagamento, incluindo seu nome, email e país. Essas informações 
podem ser relevantes para a criação do pedido no Printful.

payment_intent: O ID do pagamento no Stripe. Isso pode ser útil para rastrear o pagamento associado a este pedido.

payment_status: Indica o status do pagamento, que neste caso é "paid", indicando que o pagamento foi bem-sucedido.

success_url e cancel_url: Esses campos contêm as URLs para redirecionar o cliente após um pagamento bem-sucedido ou malsucedido. 
Você pode usar a success_url para redirecionar o cliente de volta ao seu site após um pagamento bem-sucedido.

payment_method_types: Indica o método de pagamento usado, que neste caso é "card" (cartão de crédito).

Para criar um pedido no servidor Printful, você pode usar as informações da sessão de checkout do Stripe para construir um pedido 
no formato aceito pelo Printful. Você pode usar o ID da sessão de checkout, o valor total, as informações do cliente e outros 
detalhes relevantes para criar o pedido no Printful com os produtos que o cliente comprou.

Lembre-se de que a estrutura específica do pedido no Printful pode depender da API do Printful e de como você integra as informações 
do Stripe com o Printful. Certifique-se de ler a documentação da API do Printful para entender como criar pedidos e quais informações 
são necessárias.

======================================================================================================================================

>ngrok http 3001

=====================================================================================================================================

03/11/2023
19:36
O erro que você está enfrentando ao criar um pedido no Printful é:

csharp
Copy code
Erro ao criar pedido no Printful: AxiosError: Request failed with status code 400
Além disso, o erro específico fornecido é:

arduino
Copy code
Recipient: Address line 1 cannot be blank.
Esse erro indica que o campo "Address Line 1" (linha de endereço 1) no objeto recipient está em branco ou vazio. No seu código, 
o objeto recipient é definido com um endereço fictício, mas parece que isso não está sendo transmitido corretamente na solicitação 
ao Printful. Verifique o objeto recipient e certifique-se de que o endereço esteja corretamente definido com todos os campos 
necessários, incluindo "address" (endereço), "city" (cidade), "state_code" (código do estado), "country_code" (código do país) 
e "zip" (CEP).

Você pode adicionar mais logs para ajudar a depurar o problema, como você já fez, mas, além disso, verifique se os dados no 
objeto recipient estão sendo transmitidos corretamente na solicitação ao Printful. Certifique-se de que o endereço não esteja 
vazio ou contenha espaços em branco. Certifique-se também de que você está usando os campos corretos para o endereço 
(por exemplo, "line1" para a primeira linha do endereço) de acordo com a API do Printful.

Se o problema persistir, verifique a documentação da API do Printful ou entre em contato com o suporte do Printful para obter 
assistência adicional na criação do pedido corretamente.
